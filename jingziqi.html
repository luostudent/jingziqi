<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…çº§äº•å­—æ£‹ - äººæœºå¯¹æˆ˜</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind é…ç½® -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                        dark: '#1E293B',
                        light: '#F8FAFC'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'glow': '0 0 15px rgba(59, 130, 246, 0.5)',
                        'glow-win': '0 0 20px rgba(16, 185, 129, 0.7)',
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .cell-hover {
                transition: all 0.2s ease;
            }
            .cell-hover:hover:not(.cell-filled) {
                background-color: rgba(59, 130, 246, 0.1);
                transform: scale(1.05);
            }
            .board-grid {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                grid-template-rows: repeat(3, 1fr);
                gap: 4px;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }
            .animate-fade-in {
                animation: fadeIn 0.5s ease-in-out;
            }
            .animate-scale-in {
                animation: scaleIn 0.3s ease-out;
            }
            .animate-pulse-slow {
                animation: pulseSlow 2s infinite;
            }
            @keyframes fadeIn {
                from { opacity: 0; }
                to { opacity: 1; }
            }
            @keyframes scaleIn {
                from { transform: scale(0.8); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }
            @keyframes pulseSlow {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.7; }
            }
        }
    </style>
</head>
<body class="font-inter bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen text-dark">
    <!-- é¡¶éƒ¨å¯¼èˆª -->
    <header class="bg-white/80 backdrop-blur-sm shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-10 h-10 rounded-lg bg-primary flex items-center justify-center">
                    <i class="fa fa-th text-white text-xl"></i>
                </div>
                <h1 class="text-xl font-bold bg-gradient-to-r from-primary to-accent bg-clip-text text-transparent">è¶…çº§äº•å­—æ£‹</h1>
            </div>
            <div class="flex items-center gap-4">
                <button id="help-btn" class="text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-question-circle mr-1"></i> å¸®åŠ©
                </button>
                <button id="stats-btn" class="text-gray-600 hover:text-primary transition-colors">
                    <i class="fa fa-bar-chart mr-1"></i> ç»Ÿè®¡
                </button>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8 md:py-16">
        <!-- æ¸¸æˆæ ‡é¢˜å’ŒçŠ¶æ€ -->
        <div class="text-center mb-8 animate-fade-in">
            <h2 class="text-[clamp(1.8rem,5vw,2.5rem)] font-bold mb-2 text-shadow">äººæœºå¯¹æˆ˜</h2>
            <p id="game-status" class="text-gray-600 text-lg">ä½ æ‰§ <span class="text-primary font-semibold">X</span>ï¼ŒAIæ‰§ <span class="text-secondary font-semibold">O</span> - è½®åˆ°ä½ äº†</p>
        </div>
        
        <!-- æ¸¸æˆè®¾ç½®åŒºåŸŸ -->
        <div class="max-w-md mx-auto mb-8 animate-fade-in">
            <h3 class="text-center text-lg font-medium mb-4">æ¸¸æˆè®¾ç½®</h3>
            
            <!-- å…ˆæ‰‹/åæ‰‹é€‰æ‹© -->
            <div class="mb-6">
                <p class="text-sm text-gray-500 mb-2 text-center">é€‰æ‹©è°å…ˆå¼€å§‹</p>
                <div class="grid grid-cols-2 gap-3">
                    <button id="first-player-btn" class="starting-btn py-3 rounded-lg bg-primary text-white shadow-glow">
                        <i class="fa fa-user block mb-1"></i>
                        <span>ä½ å…ˆå¼€å§‹</span>
                    </button>
                    <button id="second-player-btn" class="starting-btn py-3 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors">
                        <i class="fa fa-robot block mb-1"></i>
                        <span>AIå…ˆå¼€å§‹</span>
                    </button>
                </div>
            </div>
            
            <!-- éš¾åº¦é€‰æ‹© -->
            <div>
                <p class="text-sm text-gray-500 mb-2 text-center">é€‰æ‹©éš¾åº¦</p>
                <div class="grid grid-cols-3 gap-3">
                    <button class="difficulty-btn py-3 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors" data-difficulty="easy">
                        <i class="fa fa-smile-o block mb-1"></i>
                        <span>ç®€å•</span>
                    </button>
                    <button class="difficulty-btn py-3 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors" data-difficulty="medium">
                        <i class="fa fa-meh-o block mb-1"></i>
                        <span>ä¸­ç­‰</span>
                    </button>
                    <button class="difficulty-btn py-3 rounded-lg bg-primary text-white shadow-glow" data-difficulty="hard">
                        <i class="fa fa-frown-o block mb-1"></i>
                        <span>å›°éš¾</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- æ¸¸æˆåŒºåŸŸ -->
        <div class="flex flex-col lg:flex-row items-center gap-8 lg:gap-16 max-w-5xl mx-auto">
            <!-- æ£‹ç›˜ -->
            <div class="relative w-full max-w-md aspect-square animate-fade-in" style="animation-delay: 0.2s">
                <div id="board" class="board-grid w-full h-full bg-dark rounded-xl p-1 shadow-lg">
                    <!-- æ£‹ç›˜æ ¼å­å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <!-- åŠ è½½æŒ‡ç¤ºå™¨ (AIæ€è€ƒæ—¶æ˜¾ç¤º) -->
                <div id="ai-thinking" class="hidden absolute inset-0 bg-dark/70 backdrop-blur-sm rounded-xl flex flex-col items-center justify-center">
                    <div class="w-12 h-12 border-4 border-gray-300 border-t-primary rounded-full animate-spin mb-4"></div>
                    <p class="text-white font-medium">AIæ­£åœ¨æ€è€ƒ...</p>
                </div>
                
                <!-- æ¸¸æˆç»“æœè¦†ç›–å±‚ -->
                <div id="game-result" class="hidden absolute inset-0 bg-dark/80 backdrop-blur-sm rounded-xl flex flex-col items-center justify-center">
                    <h3 id="result-text" class="text-2xl font-bold text-white mb-6"></h3>
                    <button id="play-again" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-all shadow-glow">
                        å†æ¥ä¸€å±€
                    </button>
                </div>
            </div>
            
            <!-- æ¸¸æˆä¿¡æ¯å’Œæ§åˆ¶ -->
            <div class="w-full max-w-md animate-fade-in" style="animation-delay: 0.4s">
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fa fa-info-circle text-primary mr-2"></i> æ¸¸æˆä¿¡æ¯
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <span class="inline-block w-6 h-6 rounded-md bg-primary/20 text-primary flex items-center justify-center mr-2">X</span>
                                <span>ä½ çš„å›åˆ</span>
                            </div>
                            <span id="player-wins" class="font-semibold">0</span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <span class="inline-block w-6 h-6 rounded-md bg-secondary/20 text-secondary flex items-center justify-center mr-2">O</span>
                                <span>AI å›åˆ</span>
                            </div>
                            <span id="ai-wins" class="font-semibold">0</span>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <div class="flex items-center">
                                <span class="inline-block w-6 h-6 rounded-md bg-gray-200 text-gray-600 flex items-center justify-center mr-2">
                                    <i class="fa fa-refresh text-xs"></i>
                                </span>
                                <span>å¹³å±€</span>
                            </div>
                            <span id="draws" class="font-semibold">0</span>
                        </div>
                    </div>
                    
                    <div class="mt-6 pt-4 border-t border-gray-100">
                        <div class="flex justify-between">
                            <button id="new-game" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                <i class="fa fa-gamepad mr-1"></i> æ–°æ¸¸æˆ
                            </button>
                            <button id="undo-move" class="px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
                                <i class="fa fa-undo mr-1"></i> æ‚”æ£‹
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- æç¤ºå’ŒæŠ€å·§ -->
                <div class="bg-gradient-to-br from-primary/5 to-accent/5 rounded-xl p-6">
                    <h3 class="text-lg font-semibold mb-3 flex items-center">
                        <i class="fa fa-lightbulb-o text-accent mr-2"></i> æ¸¸æˆæŠ€å·§
                    </h3>
                    <ul class="space-y-2 text-gray-600 text-sm">
                        <li class="flex items-start">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>å…ˆå æ®ä¸­å¿ƒä½ç½®é€šå¸¸æ˜¯ä¼˜åŠ¿å¼€å±€</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>å§‹ç»ˆæ³¨æ„é˜»æ­¢AIå½¢æˆä¸‰å­è¿çº¿</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-check-circle text-secondary mt-1 mr-2"></i>
                            <span>å°è¯•åˆ›é€ å¤šç§è·èƒœæ–¹å¼è®©AIéš¾ä»¥é˜²å®ˆ</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fa fa-exclamation-circle text-accent mt-1 mr-2"></i>
                            <span>åœ¨å›°éš¾æ¨¡å¼ä¸‹ï¼ŒAIä¸ä¼šçŠ¯é”™ï¼Œå®Œç¾é˜²å®ˆæ‰€æœ‰è¿›æ”»</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </main>
    
    <!-- å¸®åŠ©æ¨¡æ€æ¡† -->
    <div id="help-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto p-6 animate-scale-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">æ¸¸æˆè§„åˆ™</h3>
                <button id="close-help" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="space-y-4 text-gray-700">
                <p>äº•å­—æ£‹æ˜¯ä¸€ç§ç»å…¸çš„ä¸¤äººå¯¹æˆ˜æ¸¸æˆï¼Œåœ¨3Ã—3çš„ç½‘æ ¼ä¸Šè¿›è¡Œã€‚</p>
                
                <h4 class="font-semibold text-lg">åŸºæœ¬è§„åˆ™ï¼š</h4>
                <ul class="list-disc pl-5 space-y-2">
                    <li>ä½ æ‰§Xï¼ŒAIæ‰§Oï¼Œè½®æµåœ¨æ ¼å­ä¸­è½å­</li>
                    <li>ç‡å…ˆåœ¨æ¨ªå‘ã€çºµå‘æˆ–å¯¹è§’çº¿ä¸Šå½¢æˆä¸‰å­è¿çº¿è€…è·èƒœ</li>
                    <li>å¦‚æœæ‰€æœ‰æ ¼å­éƒ½è¢«å¡«æ»¡ä½†æ— äººè·èƒœï¼Œåˆ™åˆ¤å®šä¸ºå¹³å±€</li>
                </ul>
                
                <h4 class="font-semibold text-lg">éš¾åº¦è¯´æ˜ï¼š</h4>
                <ul class="list-disc pl-5 space-y-2">
                    <li><strong>ç®€å•</strong>ï¼šAIä¼šçŠ¯ä¸€äº›é”™è¯¯ï¼Œé€‚åˆåˆå­¦è€…</li>
                    <li><strong>ä¸­ç­‰</strong>ï¼šAIæœ‰è¾ƒå¥½çš„é˜²å®ˆï¼Œä½†ä»æœ‰æœºä¼šå‡»è´¥</li>
                    <li><strong>å›°éš¾</strong>ï¼šAIä½¿ç”¨æœ€ä¼˜ç®—æ³•ï¼Œä»ä¸çŠ¯é”™ï¼Œå®Œç¾é˜²å®ˆ</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- ç»Ÿè®¡æ¨¡æ€æ¡† -->
    <div id="stats-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="bg-white rounded-xl max-w-md w-full max-h-[90vh] overflow-y-auto p-6 animate-scale-in">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold">æ¸¸æˆç»Ÿè®¡</h3>
                <button id="close-stats" class="text-gray-500 hover:text-gray-700">
                    <i class="fa fa-times"></i>
                </button>
            </div>
            <div class="space-y-6 text-gray-700">
                <div class="text-center">
                    <div class="text-sm text-gray-500 mb-2">æ€»å¯¹æˆ˜æ¬¡æ•°</div>
                    <div id="total-games" class="text-3xl font-bold text-primary">0</div>
                </div>
                
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div class="bg-primary/10 rounded-lg p-4">
                        <div class="text-sm text-gray-500 mb-1">ä½ çš„èƒœç‡</div>
                        <div id="player-win-rate" class="text-xl font-bold text-primary">0%</div>
                    </div>
                    <div class="bg-secondary/10 rounded-lg p-4">
                        <div class="text-sm text-gray-500 mb-1">AIèƒœç‡</div>
                        <div id="ai-win-rate" class="text-xl font-bold text-secondary">0%</div>
                    </div>
                    <div class="bg-gray-100 rounded-lg p-4">
                        <div class="text-sm text-gray-500 mb-1">å¹³å±€ç‡</div>
                        <div id="draw-rate" class="text-xl font-bold text-gray-600">0%</div>
                    </div>
                </div>
                
                <div>
                    <h4 class="font-semibold mb-3">æŒ‰éš¾åº¦ç»Ÿè®¡</h4>
                    <div class="space-y-3">
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>ç®€å•éš¾åº¦</span>
                                <span id="easy-games">0 åœº</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="easy-win-bar" class="bg-primary h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>ä¸­ç­‰éš¾åº¦</span>
                                <span id="medium-games">0 åœº</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="medium-win-bar" class="bg-primary h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-1">
                                <span>å›°éš¾éš¾åº¦</span>
                                <span id="hard-games">0 åœº</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div id="hard-win-bar" class="bg-primary h-2 rounded-full" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button id="reset-stats" class="w-full py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                    <i class="fa fa-trash mr-1"></i> é‡ç½®ç»Ÿè®¡æ•°æ®
                </button>
            </div>
        </div>
    </div>

    <footer class="bg-white/80 backdrop-blur-sm py-6 mt-12">
        <div class="container mx-auto px-4 text-center text-gray-500 text-sm">
            <p>è¶…çº§äº•å­—æ£‹ &copy; 2023 - è¶…å¼ºAIå¯¹æˆ˜ä½“éªŒ</p>
            <p class="mt-1">å›°éš¾æ¨¡å¼ä½¿ç”¨ minimax ç®—æ³•ï¼ŒAIä»ä¸çŠ¯é”™</p>
        </div>
    </footer>

    <script>
        // æ¸¸æˆçŠ¶æ€å˜é‡
        let board = Array(9).fill('');
        let currentPlayer = 'X'; // ç©å®¶æ˜¯Xï¼ŒAIæ˜¯O
        let gameActive = true;
        let difficulty = 'hard'; // é»˜è®¤å›°éš¾æ¨¡å¼
        let moveHistory = [];
        let playerStarts = true; // é»˜è®¤ä¸ºç©å®¶å…ˆå¼€å§‹
        
        // æ¸¸æˆç»Ÿè®¡
        let stats = {
            playerWins: 0,
            aiWins: 0,
            draws: 0,
            totalGames: 0,
            byDifficulty: {
                easy: { games: 0, wins: 0 },
                medium: { games: 0, wins: 0 },
                hard: { games: 0, wins: 0 }
            },
            byStarting: {
                player: { games: 0, wins: 0 },
                ai: { games: 0, wins: 0 }
            }
        };
        
        // èƒœåˆ©ç»„åˆ
        const winCombos = [
            [0, 1, 2], [3, 4, 5], [6, 7, 8], // æ¨ªå‘
            [0, 3, 6], [1, 4, 7], [2, 5, 8], // çºµå‘
            [0, 4, 8], [2, 4, 6]             // å¯¹è§’çº¿
        ];
        
        // DOM å…ƒç´ 
        const boardElement = document.getElementById('board');
        const gameStatusElement = document.getElementById('game-status');
        const aiThinkingElement = document.getElementById('ai-thinking');
        const gameResultElement = document.getElementById('game-result');
        const resultTextElement = document.getElementById('result-text');
        const playAgainButton = document.getElementById('play-again');
        const newGameButton = document.getElementById('new-game');
        const undoMoveButton = document.getElementById('undo-move');
        const difficultyButtons = document.querySelectorAll('.difficulty-btn');
        const startingButtons = document.querySelectorAll('.starting-btn');
        const firstPlayerButton = document.getElementById('first-player-btn');
        const secondPlayerButton = document.getElementById('second-player-btn');
        
        // ç»Ÿè®¡å…ƒç´ 
        const playerWinsElement = document.getElementById('player-wins');
        const aiWinsElement = document.getElementById('ai-wins');
        const drawsElement = document.getElementById('draws');
        
        // æ¨¡æ€æ¡†å…ƒç´ 
        const helpBtn = document.getElementById('help-btn');
        const statsBtn = document.getElementById('stats-btn');
        const helpModal = document.getElementById('help-modal');
        const statsModal = document.getElementById('stats-modal');
        const closeHelpBtn = document.getElementById('close-help');
        const closeStatsBtn = document.getElementById('close-stats');
        const resetStatsBtn = document.getElementById('reset-stats');
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // åŠ è½½ä¿å­˜çš„ç»Ÿè®¡æ•°æ®
            loadStats();
            updateStatsDisplay();
            
            // åˆ›å»ºæ£‹ç›˜
            createBoard();
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€æ˜¾ç¤º
            updateGameStatus();
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            addEventListeners();
        }
        
        // åˆ›å»ºæ£‹ç›˜
        function createBoard() {
            boardElement.innerHTML = '';
            
            for (let i = 0; i < 9; i++) {
                const cell = document.createElement('div');
                cell.classList.add('cell', 'cell-hover', 'bg-white', 'rounded-md', 'flex', 'items-center', 'justify-center', 'text-4xl', 'font-bold', 'cursor-pointer');
                cell.dataset.index = i;
                
                boardElement.appendChild(cell);
            }
        }
        
        // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        function addEventListeners() {
            // å•å…ƒæ ¼ç‚¹å‡»äº‹ä»¶
            boardElement.addEventListener('click', (e) => {
                if (e.target.classList.contains('cell')) {
                    const index = parseInt(e.target.dataset.index);
                    handleCellClick(index);
                }
            });
            
            // å†æ¥ä¸€å±€æŒ‰é’®
            playAgainButton.addEventListener('click', resetGame);
            
            // æ–°æ¸¸æˆæŒ‰é’®
            newGameButton.addEventListener('click', resetGame);
            
            // æ‚”æ£‹æŒ‰é’®
            undoMoveButton.addEventListener('click', undoMove);
            
            // éš¾åº¦é€‰æ‹©æŒ‰é’®
            difficultyButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // æ›´æ–°æŒ‰é’®æ ·å¼
                    difficultyButtons.forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-white', 'shadow-glow');
                        btn.classList.add('bg-gray-100', 'hover:bg-gray-200');
                    });
                    
                    button.classList.remove('bg-gray-100', 'hover:bg-gray-200');
                    button.classList.add('bg-primary', 'text-white', 'shadow-glow');
                    
                    // è®¾ç½®éš¾åº¦
                    difficulty = button.dataset.difficulty;
                    
                    // é‡ç½®æ¸¸æˆ
                    resetGame();
                });
            });
            
            // å…ˆæ‰‹/åæ‰‹é€‰æ‹©æŒ‰é’®
            startingButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // æ›´æ–°æŒ‰é’®æ ·å¼
                    startingButtons.forEach(btn => {
                        btn.classList.remove('bg-primary', 'text-white', 'shadow-glow');
                        btn.classList.add('bg-gray-100', 'hover:bg-gray-200');
                    });
                    
                    button.classList.remove('bg-gray-100', 'hover:bg-gray-200');
                    button.classList.add('bg-primary', 'text-white', 'shadow-glow');
                    
                    // è®¾ç½®è°å…ˆå¼€å§‹
                    playerStarts = button.id === 'first-player-btn';
                    
                    // é‡ç½®æ¸¸æˆ
                    resetGame();
                });
            });
            
            // å¸®åŠ©æ¨¡æ€æ¡†
            helpBtn.addEventListener('click', () => {
                helpModal.classList.remove('hidden');
            });
            
            closeHelpBtn.addEventListener('click', () => {
                helpModal.classList.add('hidden');
            });
            
            // ç»Ÿè®¡æ¨¡æ€æ¡†
            statsBtn.addEventListener('click', () => {
                updateStatsModal();
                statsModal.classList.remove('hidden');
            });
            
            closeStatsBtn.addEventListener('click', () => {
                statsModal.classList.add('hidden');
            });
            
            // é‡ç½®ç»Ÿè®¡æ•°æ®
            resetStatsBtn.addEventListener('click', () => {
                if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰ç»Ÿè®¡æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                    resetAllStats();
                    updateStatsDisplay();
                    updateStatsModal();
                }
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            helpModal.addEventListener('click', (e) => {
                if (e.target === helpModal) helpModal.classList.add('hidden');
            });
            
            statsModal.addEventListener('click', (e) => {
                if (e.target === statsModal) statsModal.classList.add('hidden');
            });
        }
        
        // å¤„ç†å•å…ƒæ ¼ç‚¹å‡»
        function handleCellClick(index) {
            // æ£€æŸ¥æ¸¸æˆæ˜¯å¦æ´»è·ƒï¼Œå•å…ƒæ ¼æ˜¯å¦å·²è¢«å¡«å……ï¼Œæ˜¯å¦æ˜¯ç©å®¶å›åˆ
            if (!gameActive || board[index] !== '' || currentPlayer !== 'X') {
                return;
            }
            
            // è®°å½•å†å²
            moveHistory.push([...board]);
            
            // æ›´æ–°æ£‹ç›˜å’ŒUI
            board[index] = 'X';
            updateBoardUI();
            
            // æ£€æŸ¥æ¸¸æˆçŠ¶æ€
            if (checkWinner()) {
                gameActive = false;
                stats.playerWins++;
                stats.totalGames++;
                stats.byDifficulty[difficulty].games++;
                stats.byDifficulty[difficulty].wins++;
                stats.byStarting[playerStarts ? 'player' : 'ai'].games++;
                stats.byStarting[playerStarts ? 'player' : 'ai'].wins++;
                saveStats();
                updateStatsDisplay();
                showResult('ä½ èµ¢äº†ï¼ğŸ‰');
                return;
            }
            
            if (checkDraw()) {
                gameActive = false;
                stats.draws++;
                stats.totalGames++;
                stats.byDifficulty[difficulty].games++;
                stats.byStarting[playerStarts ? 'player' : 'ai'].games++;
                saveStats();
                updateStatsDisplay();
                showResult('å¹³å±€ï¼ğŸ¤');
                return;
            }
            
            // åˆ‡æ¢åˆ°AIå›åˆ
            currentPlayer = 'O';
            updateGameStatus();
            
            // AIèµ°æ£‹
            setTimeout(aiMove, 500); // ç¨å¾®å»¶è¿Ÿï¼Œè®©ç©å®¶çœ‹åˆ°AIåœ¨"æ€è€ƒ"
        }
        
        // AIèµ°æ£‹
        function aiMove() {
            if (!gameActive) return;
            
            // æ˜¾ç¤ºAIæ€è€ƒçŠ¶æ€
            aiThinkingElement.classList.remove('hidden');
            
            let bestMove;
            
            // æ ¹æ®éš¾åº¦é€‰æ‹©ä¸åŒçš„AIç­–ç•¥
            switch(difficulty) {
                case 'easy':
                    // ç®€å•éš¾åº¦ï¼šéšæœºé€‰æ‹©ï¼Œå¶å°”çŠ¯é”™è¯¯
                    bestMove = getEasyAIMove();
                    break;
                case 'medium':
                    // ä¸­ç­‰éš¾åº¦ï¼šè¾ƒå¥½çš„ç­–ç•¥ï¼Œä½†å¶å°”çŠ¯é”™è¯¯
                    bestMove = getMediumAIMove();
                    break;
                case 'hard':
                default:
                    // å›°éš¾éš¾åº¦ï¼šä½¿ç”¨minimaxç®—æ³•ï¼Œæœ€ä¼˜èµ°æ³•
                    bestMove = getHardAIMove();
                    break;
            }
            
            // å»¶è¿Ÿéšè—æ€è€ƒçŠ¶æ€ï¼Œè®©ä½“éªŒæ›´è‡ªç„¶
            setTimeout(() => {
                // è®°å½•å†å²
                moveHistory.push([...board]);
                
                // æ‰§è¡ŒAIçš„èµ°æ³•
                board[bestMove] = 'O';
                updateBoardUI();
                
                // éšè—AIæ€è€ƒçŠ¶æ€
                aiThinkingElement.classList.add('hidden');
                
                // æ£€æŸ¥æ¸¸æˆçŠ¶æ€
                if (checkWinner()) {
                    gameActive = false;
                    stats.aiWins++;
                    stats.totalGames++;
                    stats.byDifficulty[difficulty].games++;
                    stats.byStarting[playerStarts ? 'player' : 'ai'].games++;
                    saveStats();
                    updateStatsDisplay();
                    showResult('AIèµ¢äº†ï¼ğŸ˜¢');
                    return;
                }
                
                if (checkDraw()) {
                    gameActive = false;
                    stats.draws++;
                    stats.totalGames++;
                    stats.byDifficulty[difficulty].games++;
                    stats.byStarting[playerStarts ? 'player' : 'ai'].games++;
                    saveStats();
                    updateStatsDisplay();
                    showResult('å¹³å±€ï¼ğŸ¤');
                    return;
                }
                
                // åˆ‡æ¢å›ç©å®¶å›åˆ
                currentPlayer = 'X';
                updateGameStatus();
            }, 500);
        }
        
        // ç®€å•AIï¼šéšæœºé€‰æ‹©å¯ç”¨ä½ç½®
        function getEasyAIMove() {
            // 20%çš„æ¦‚ç‡éšæœºèµ°æ£‹ï¼ˆå¯èƒ½çŠ¯é”™è¯¯ï¼‰
            if (Math.random() < 0.2) {
                return getRandomMove();
            }
            
            // 80%çš„æ¦‚ç‡å¯»æ‰¾èƒ½ç«‹å³è·èƒœçš„èµ°æ³•ï¼Œå¦åˆ™éšæœº
            const winningMove = findWinningMove('O');
            if (winningMove !== -1) return winningMove;
            
            // å°è¯•é˜»æ­¢ç©å®¶çš„è·èƒœèµ°æ³•
            const blockingMove = findWinningMove('X');
            if (blockingMove !== -1) return blockingMove;
            
            return getRandomMove();
        }
        
        // ä¸­ç­‰AIï¼šè¾ƒå¥½çš„ç­–ç•¥ï¼Œä½†å¶å°”çŠ¯é”™è¯¯
        function getMediumAIMove() {
            // 10%çš„æ¦‚ç‡éšæœºèµ°æ£‹ï¼ˆå¶å°”çŠ¯é”™è¯¯ï¼‰
            if (Math.random() < 0.1) {
                return getRandomMove();
            }
            
            // å¯»æ‰¾èƒ½ç«‹å³è·èƒœçš„èµ°æ³•
            const winningMove = findWinningMove('O');
            if (winningMove !== -1) return winningMove;
            
            // é˜»æ­¢ç©å®¶çš„è·èƒœèµ°æ³•
            const blockingMove = findWinningMove('X');
            if (blockingMove !== -1) return blockingMove;
            
            // ä¼˜å…ˆé€‰æ‹©ä¸­å¿ƒ
            if (board[4] === '') return 4;
            
            // ç„¶åé€‰æ‹©è§’è½
            const corners = [0, 2, 6, 8];
            const availableCorners = corners.filter(index => board[index] === '');
            if (availableCorners.length > 0) {
                return availableCorners[Math.floor(Math.random() * availableCorners.length)];
            }
            
            // æœ€åé€‰æ‹©è¾¹ç¼˜
            const edges = [1, 3, 5, 7];
            const availableEdges = edges.filter(index => board[index] === '');
            if (availableEdges.length > 0) {
                return availableEdges[Math.floor(Math.random() * availableEdges.length)];
            }
            
            return getRandomMove();
        }
        
        // å›°éš¾AIï¼šä½¿ç”¨minimaxç®—æ³•ï¼Œæœ€ä¼˜èµ°æ³•
        function getHardAIMove() {
            // ä½¿ç”¨minimaxç®—æ³•æ‰¾åˆ°æœ€ä¼˜èµ°æ³•
            return minimax(board, 'O').index;
        }
        
        // Minimaxç®—æ³•å®ç°
        function minimax(currentBoard, player) {
            // è·å–æ‰€æœ‰å¯ç”¨ä½ç½®
            const availableMoves = getAvailableMoves(currentBoard);
            
            // ç»ˆç«¯çŠ¶æ€æ£€æŸ¥
            if (checkWinnerForBoard(currentBoard, 'O')) {
                return { score: 10 };
            } else if (checkWinnerForBoard(currentBoard, 'X')) {
                return { score: -10 };
            } else if (availableMoves.length === 0) {
                return { score: 0 };
            }
            
            // æ”¶é›†æ‰€æœ‰å¯èƒ½çš„èµ°æ³•åŠå…¶è¯„åˆ†
            const moves = [];
            
            for (let i = 0; i < availableMoves.length; i++) {
                // åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡å­˜å‚¨å½“å‰èµ°æ³•
                const move = {};
                move.index = availableMoves[i];
                
                // å°è¯•å½“å‰èµ°æ³•
                currentBoard[availableMoves[i]] = player;
                
                // é€’å½’è®¡ç®—è¯„åˆ†
                if (player === 'O') {
                    // AIå›åˆï¼Œæœ€å¤§åŒ–è¯„åˆ†
                    const result = minimax(currentBoard, 'X');
                    move.score = result.score;
                } else {
                    // ç©å®¶å›åˆï¼Œæœ€å°åŒ–è¯„åˆ†
                    const result = minimax(currentBoard, 'O');
                    move.score = result.score;
                }
                
                // æ’¤é”€èµ°æ³•
                currentBoard[availableMoves[i]] = '';
                
                // å­˜å‚¨èµ°æ³•
                moves.push(move);
            }
            
            // é€‰æ‹©æœ€ä½³èµ°æ³•
            let bestMove;
            if (player === 'O') {
                // AIå°è¯•æœ€å¤§åŒ–è¯„åˆ†
                let bestScore = -Infinity;
                for (let i = 0; i < moves.length; i++) {
                    if (moves[i].score > bestScore) {
                        bestScore = moves[i].score;
                        bestMove = i;
                    }
                }
            } else {
                // ç©å®¶å°è¯•æœ€å°åŒ–è¯„åˆ†
                let bestScore = Infinity;
                for (let i = 0; i < moves.length; i++) {
                    if (moves[i].score < bestScore) {
                        bestScore = moves[i].score;
                        bestMove = i;
                    }
                }
            }
            
            // è¿”å›æœ€ä½³èµ°æ³•
            return moves[bestMove];
        }
        
        // å¯»æ‰¾èƒ½ç«‹å³è·èƒœçš„èµ°æ³•
        function findWinningMove(player) {
            for (let i = 0; i < board.length; i++) {
                if (board[i] === '') {
                    // å°è¯•èµ°è¿™ä¸€æ­¥
                    board[i] = player;
                    
                    // æ£€æŸ¥æ˜¯å¦è·èƒœ
                    const isWinning = checkWinnerForBoard(board, player);
                    
                    // æ’¤é”€èµ°æ³•
                    board[i] = '';
                    
                    if (isWinning) {
                        return i;
                    }
                }
            }
            return -1;
        }
        
        // è·å–éšæœºå¯ç”¨ä½ç½®
        function getRandomMove() {
            const availableMoves = getAvailableMoves(board);
            return availableMoves[Math.floor(Math.random() * availableMoves.length)];
        }
        
        // è·å–æ‰€æœ‰å¯ç”¨ä½ç½®
        function getAvailableMoves(currentBoard) {
            return currentBoard.map((val, index) => val === '' ? index : null).filter(val => val !== null);
        }
        
        // æ£€æŸ¥æ˜¯å¦æœ‰è·èƒœè€…ï¼ˆé’ˆå¯¹å½“å‰æ£‹ç›˜ï¼‰
        function checkWinner() {
            return checkWinnerForBoard(board, currentPlayer);
        }
        
        // æ£€æŸ¥æŒ‡å®šæ£‹ç›˜æ˜¯å¦æœ‰æŒ‡å®šç©å®¶è·èƒœ
        function checkWinnerForBoard(currentBoard, player) {
            return winCombos.some(combo => {
                return combo.every(index => currentBoard[index] === player);
            });
        }
        
        // æ£€æŸ¥æ˜¯å¦å¹³å±€
        function checkDraw() {
            return board.every(cell => cell !== '') && !checkWinner();
        }
        
        // æ›´æ–°æ£‹ç›˜UI
        function updateBoardUI() {
            const cells = boardElement.querySelectorAll('.cell');
            
            cells.forEach((cell, index) => {
                // æ¸…ç©ºå•å…ƒæ ¼
                cell.textContent = '';
                cell.classList.remove('text-primary', 'text-secondary', 'cell-filled', 'shadow-glow-win');
                
                // å¦‚æœæœ‰æ£‹å­ï¼Œæ›´æ–°æ˜¾ç¤º
                if (board[index] === 'X') {
                    cell.textContent = 'X';
                    cell.classList.add('text-primary', 'cell-filled', 'animate-scale-in');
                } else if (board[index] === 'O') {
                    cell.textContent = 'O';
                    cell.classList.add('text-secondary', 'cell-filled', 'animate-scale-in');
                }
            });
            
            // å¦‚æœæ¸¸æˆç»“æŸï¼Œé«˜äº®æ˜¾ç¤ºè·èƒœçš„è¿çº¿
            if (!gameActive) {
                const winner = checkWinnerForBoard(board, 'X') ? 'X' : 
                              checkWinnerForBoard(board, 'O') ? 'O' : null;
                
                if (winner) {
                    for (const combo of winCombos) {
                        if (combo.every(index => board[index] === winner)) {
                            combo.forEach(index => {
                                cells[index].classList.add('shadow-glow-win');
                            });
                            break;
                        }
                    }
                }
            }
        }
        
        // æ›´æ–°æ¸¸æˆçŠ¶æ€æ˜¾ç¤º
        function updateGameStatus() {
            if (gameActive) {
                if (currentPlayer === 'X') {
                    gameStatusElement.innerHTML = 'ä½ æ‰§ <span class="text-primary font-semibold">X</span>ï¼ŒAIæ‰§ <span class="text-secondary font-semibold">O</span> - è½®åˆ°ä½ äº†';
                } else {
                    gameStatusElement.innerHTML = 'ä½ æ‰§ <span class="text-primary font-semibold">X</span>ï¼ŒAIæ‰§ <span class="text-secondary font-semibold">O</span> - AIæ€è€ƒä¸­...';
                }
            }
        }
        
        // æ˜¾ç¤ºæ¸¸æˆç»“æœ
        function showResult(text) {
            resultTextElement.textContent = text;
            gameResultElement.classList.remove('hidden');
        }
        
        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            board = Array(9).fill('');
            gameActive = true;
            moveHistory = [];
            
            // æ ¹æ®è®¾ç½®å†³å®šè°å…ˆå¼€å§‹
            currentPlayer = playerStarts ? 'X' : 'O';
            
            updateBoardUI();
            updateGameStatus();
            
            gameResultElement.classList.add('hidden');
            
            // å¦‚æœæ˜¯AIå…ˆå¼€å§‹ï¼ŒAIç›´æ¥èµ°ç¬¬ä¸€æ­¥
            if (!playerStarts) {
                setTimeout(aiMove, 300);
            }
        }
        
        // æ‚”æ£‹åŠŸèƒ½
        function undoMove() {
            // è‡³å°‘éœ€è¦ä¸¤æ­¥æ‰èƒ½æ‚”æ£‹ï¼ˆç©å®¶å’ŒAIå„èµ°ä¸€æ­¥ï¼‰
            if (moveHistory.length >= (playerStarts ? 2 : 1) && gameActive) {
                // å¦‚æœæ˜¯AIå…ˆå¼€å§‹ï¼Œç¬¬ä¸€æ­¥æ‚”æ£‹åªéœ€è¦æ’¤é”€ä¸€æ­¥
                const stepsToUndo = playerStarts ? 2 : 1;
                
                for (let i = 0; i < stepsToUndo; i++) {
                    moveHistory.pop();
                }
                
                const previousBoard = moveHistory.length > 0 ? moveHistory[moveHistory.length - 1] : null;
                
                if (previousBoard) {
                    board = [...previousBoard];
                } else {
                    board = Array(9).fill('');
                }
                
                currentPlayer = 'X';
                updateBoardUI();
                updateGameStatus();
            }
        }
        
        // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
        function updateStatsDisplay() {
            playerWinsElement.textContent = stats.playerWins;
            aiWinsElement.textContent = stats.aiWins;
            drawsElement.textContent = stats.draws;
        }
        
        // æ›´æ–°ç»Ÿè®¡æ¨¡æ€æ¡†
        function updateStatsModal() {
            document.getElementById('total-games').textContent = stats.totalGames;
            
            // è®¡ç®—èƒœç‡
            const total = stats.playerWins + stats.aiWins + stats.draws;
            const playerWinRate = total > 0 ? Math.round((stats.playerWins / total) * 100) : 0;
            const aiWinRate = total > 0 ? Math.round((stats.aiWins / total) * 100) : 0;
            const drawRate = total > 0 ? Math.round((stats.draws / total) * 100) : 0;
            
            document.getElementById('player-win-rate').textContent = `${playerWinRate}%`;
            document.getElementById('ai-win-rate').textContent = `${aiWinRate}%`;
            document.getElementById('draw-rate').textContent = `${drawRate}%`;
            
            // æŒ‰éš¾åº¦ç»Ÿè®¡
            for (const diff of ['easy', 'medium', 'hard']) {
                const games = stats.byDifficulty[diff].games;
                const wins = stats.byDifficulty[diff].wins;
                const winRate = games > 0 ? Math.round((wins / games) * 100) : 0;
                
                document.getElementById(`${diff}-games`).textContent = `${games} åœº`;
                document.getElementById(`${diff}-win-bar`).style.width = `${winRate}%`;
            }
        }
        
        // ä¿å­˜ç»Ÿè®¡æ•°æ®åˆ°localStorage
        function saveStats() {
            localStorage.setItem('ticTacToeStats', JSON.stringify(stats));
        }
        
        // ä»localStorageåŠ è½½ç»Ÿè®¡æ•°æ®
        function loadStats() {
            const savedStats = localStorage.getItem('ticTacToeStats');
            if (savedStats) {
                stats = JSON.parse(savedStats);
            }
        }
        
        // é‡ç½®æ‰€æœ‰ç»Ÿè®¡æ•°æ®
        function resetAllStats() {
            stats = {
                playerWins: 0,
                aiWins: 0,
                draws: 0,
                totalGames: 0,
                byDifficulty: {
                    easy: { games: 0, wins: 0 },
                    medium: { games: 0, wins: 0 },
                    hard: { games: 0, wins: 0 }
                },
                byStarting: {
                    player: { games: 0, wins: 0 },
                    ai: { games: 0, wins: 0 }
                }
            };
            saveStats();
        }
        
        // åˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
    
